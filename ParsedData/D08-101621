We compute the marginal beliefs for all i together in O(n) total time: TREE and PTREE must sum over assignments to the O(n2) neighboring variables {Lij}.
    There are now exponentially many non-zero summands, those in which A corresponds to a valid tree.
    Nonetheless, 16Which is itself an exact BP algorithm, but on a different graph&#8212;a junction tree formed from the graph of TRIGRAM subfactors.
    Each variable in the junction tree is a bigram.
    If we had simply replaced the global TRIGRAM factor with its subfactors in the full factor graph, we would have had to resort to Generalized BP (Yedidia et al., 2004) to obtain the same exact results.
    17But taking it = 1 gives the same results, up to a constant.
    18As a matter of implementation, this odds ratio qL,, can be used to represent the incoming message qL., everywhere. we can follow the same approach as for EXACTLY1.
    Steps 1 and 4 are modified to iterate over all i, j such that Lij is a variable.
    In step 3, the partition function PA